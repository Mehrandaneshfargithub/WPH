@inject WPH.Resources.SharedViewLocalizer Localizer

<div class="col-xs-12" style="display:flex;direction:ltr;padding:0">


    <div class="col-xs-6" style="padding:0;margin-right:1rem">
        <label for="AllDisease" id="employees">@Localizer["AllDisease"]</label>
        <br />
        <div style="clear:both;">

            @(Html.Kendo().ListBox()
               .Name("AllDisease")
               .Toolbar(toolbar =>
               {
                   toolbar.Position(ListBoxToolbarPosition.Right);
                   toolbar.Tools(tools => tools

                       .TransferTo()
                       .TransferFrom()
                       .TransferAllTo()
                       .TransferAllFrom()
                   );
               })
               .ConnectWith("PatientDisease")
               .DataSource(source =>
               {
                   source.Read(read =>
                   {
                       read.Action("GetAllDiseaseForListBox", "Disease").Data("GetPatientId");
                   });
               })
               .DataTextField("Text")
               .DataValueField("Value")
               .Selectable(ListBoxSelectable.Multiple)
               .HtmlAttributes(new { style = "width: 100%" })
            )
        </div>
        <div style="clear:both;">
            @if ((bool)ViewBag.AccessNewDisease)
            {
                @(Html.Kendo().Button()
                            .Name("btn-AddDis")
                            .HtmlAttributes(new { style = "font-size:15px;height:35px;margin:2px;", type = "button", @class = "pull-left btn btn-danger", onclick = "AddDisease()" })
                            .Content(Localizer["NewDisease"]))
            }
        </div>

    </div>

    <div class="col-xs-6" style="padding:0;margin:0">
        <label for="PatientDisease">@Localizer["PatientDisease"]</label>
        <br />
        @(Html.Kendo().ListBox()
                .Name("PatientDisease")
                .ConnectWith("AllDisease")
                .DataSource(source =>
                {
                    source.Read(read =>
                    {
                        read.Action("GetAllDiseaseForPatient", "Patient").Data("GetPatientId");
                    });
                })

                .DataTextField("Text")
                .DataValueField("Value")
                .Events(e => e.Add("AddDiseaseToPatient")
                .Remove("RemoveDiseaseFromPatient"))
                .Selectable(ListBoxSelectable.Multiple)
                .HtmlAttributes(new { style = "width: 100%" })
            )

    </div>

</div>

<script>

    function AddDisease(element) {

        $('#AddDiseaseModal #ERROR_SomeThingWentWrong').addClass('hidden');
        $('#AddDiseaseModal #ERROR_Data').addClass('hidden');
        $('#Name-Exist').addClass('hidden');

        var link = "/Disease/AddNewModal";
        $(".loader").removeClass("hidden");

        let header = $("#newDiseaseText").text();

        $('#AddDiseaseModal-header').text(header);
        $('#AddDiseaseModal').modal('toggle');
        $('#AddDiseaseModal-body').load(link, function () {
            $(".loader").fadeIn("slow");
            $(".loader").addClass("hidden");
        });

    }

    function addNewDisease() {

        $('#AddDiseaseModal #ERROR_SomeThingWentWrong').addClass('hidden');
        $('#AddDiseaseModal #ERROR_Data').addClass('hidden');
        $('#AddDiseaseModal #Name-Exist').addClass('hidden');

        $('.emptybox').addClass('hidden');
        var isEmmpty = true;
        $('#AddDiseaseModal .emptybox').each(function () {
            if ($(this).attr('data-isEssential') === 'true') {
                var empty = $(this).attr('id');
                if ($('[data-checkEmpty="' + empty + '"]').val() === "") {
                    $(this).removeClass('hidden');
                    isEmmpty = false;
                    return;
                }
            }
        });

        if (isEmmpty === false) {
            return;
        }

        var Medicines = [];
        var medicinesItemList = $('#AddDiseaseModal #allMedsForDisease').data('kendoListBox').dataItems();
        for (var i = 0; i < medicinesItemList.length; i++) {
            Medicines.push(medicinesItemList[i]["Guid"]);
        }


        var Symptoms = [];
        var symptomsItemList = $('#AddDiseaseModal #allSymptomsForDisease').data('kendoListBox').dataItems();
        for (var i = 0; i < symptomsItemList.length; i++) {
            Symptoms.push(symptomsItemList[i]["Guid"]);
        }

        var link = "/Disease/AddOrUpdate";

        var token = $(':input:hidden[name*="RequestVerificationToken"]');
        var data = {
            __RequestVerificationToken: token.attr('value'),
            Guid: $("#AddDiseaseModal #Guid").val(),
            Name: $("#AddDiseaseModal #Name").val(),
            NameHolder: $("#AddDiseaseModal #NameHolder").val(),
            Explanation: $("#AddDiseaseModal #Explanation").val(),
            DiseaseTypeId: $("#AddDiseaseModal #DiseaseTypeId").val(),
            AllMedsForDisease: Medicines,
            AllSymptomsForDisease: Symptoms
        };


        $(".loader").removeClass("hidden");
        $.ajax({
            type: "Post",
            url: link,
            data: data,
            success: function (response) {
                if (response !== 0) {
                    if (response === "ValueIsRepeated") {

                        $('#AddDiseaseModal #Name-Exist').removeClass('hidden');

                        $(".loader").fadeIn("slow");
                        $(".loader").addClass("hidden");
                    } else if (response === "DataNotValid") {

                        $("#AddDiseaseModal #ERROR_Data").removeClass("hidden");
                        $(".loader").fadeIn("slow");
                        $(".loader").addClass("hidden");

                    } else {

                        $("#AllDisease").data("kendoListBox").dataSource.read();

                        $('#AddDiseaseModal').modal('hide');
                        $(".modal-backdrop:last").remove();
                        $('#AddDiseaseModal-body').empty();
                        $(".loader").fadeIn("slow");
                        $(".loader").addClass("hidden");

                    }
                } else {

                    $('#AddDiseaseModal #ERROR_SomeThingWentWrong').removeClass('hidden');

                    $(".loader").fadeIn("slow");
                    $(".loader").addClass("hidden");
                }
            }
        });
    }

    function closeAddDiseaseModal() {

        $('#AddDiseaseModal').modal('hide');
        $('#AddDiseaseModal-body').empty();
        $(".modal-backdrop:last").remove();

    }

</script>