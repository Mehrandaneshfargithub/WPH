@model string


<div class="col-sm-12 hidden MyFont-Roboto-grid" id="variables" style="display:flex;flex-wrap:wrap;margin-top: 1rem;direction:ltr">


</div>


<script>

    $(document).ready(() => {


        


    })


    function onVariablechange(element) {

        let id = $(element).attr('data-id');
        let ValGuid = $(element).attr('data-valueGuid');
        let status = $(element).attr('data-status');
        let receptionId = $("#Guid").val();
        let patientId = $("#PatientId").val();
        let value = $(element).val();
        if ($(element).hasClass('checkBoxVariable')) {
            value = $(element).is(':checked');
        }


        if (ValGuid != "") {
            $.ajax({

                type: "Post",
                data: { VariableValueId: ValGuid, Value: value },
                url: "/PatientVariable/UpdatePatientVariableValue",

            })
        }



    }

    function createVariables() {
        let patientId = $("#PatientId").val();
        let receptionId = $("#Guid").val();
        let display = "@Model";

        $.ajax({
            type: "Post",
            data: { PatientId: patientId, ReceptionId: receptionId, DisplayType: display },
            url: "/PatientVariable/GetAllVariablesForPatient",
            success: function (response) {

                if (response.length > 0) {
                    $("#variables").removeClass('hidden');
                }


                for (let i = 0; i < response.length; i++) {

                    let className = "";

                    if (response[i].VariableTypeName === "Text" || response[i].VariableTypeName === "Numerical") {
                        if (response[i].VariableTypeName === "Text")
                            className = "TextVariable"
                        else {
                            className = "NumericalVariable"
                        }

                        let val = (response[i].PatientVariablesValues[0] === undefined) ? "" : response[i].PatientVariablesValues[0].Value;
                        let valGuid = (response[i].PatientVariablesValues[0] === undefined) ? "" : response[i].PatientVariablesValues[0].Guid;

                        $("#variables")
                            .append("<div class='col-sm-6' style='display: flex;padding:0.5rem;margin:0;justify-content: flex-end;align-items: center'><div class='col-sm-4' style='display: flex; margin: 0;justify-content: flex-end;text-align: right'><h3 class='MyFont-Roboto-grid'>" + response[i].VariableName + ": </h3></div>" +
                                '<div class="col-sm-8" style="display: flex;padding-right:2rem;padding-left:1.5rem"><input style = "width: 100%; margin: 0"  class= "boldText ' + className +
                            '" data-status=' + response[i].VariableStatusName + ' value="' + val + '" onchange = "onVariablechange(this)"   data-id="' + response[i].Id + '"  data-valueGuid="' + valGuid +'" data-variable=""/></div> ' +
                                "</div>");
                    }
                    else {
                        className = "checkBoxVariable"
                        let val = (response[i].PatientVariablesValues[0] === undefined) ? false : response[i].PatientVariablesValues[0].Value;
                        let valGuid = (response[i].PatientVariablesValues[0] === undefined) ? "" : response[i].PatientVariablesValues[0].Guid;

                        let chk;

                        if (val === false)
                            chk = "";
                        else
                            chk = "checked"

                        $("#variables")
                            .append("<div class='col-sm-6' style='display: flex;padding:0;margin:0;align-items:center'>" +
                                '<div class="col-sm-12" style="display: flex;padding:0;margin:0;align-items:flex-start;justify-content: center"><span style="margin:0 0.5rem">' + response[i].VariableName +
                                '</span><input  type = "checkbox"  class= "boldText ' + className + '" data-status=' + response[i].VariableStatusName +
                            ' value=' + true + ' ' + chk + ' onchange = "onVariablechange(this)"   data-id="' + response[i].Id + '" data-valueGuid="' + valGuid +'" data-variable=""/></div> ' +
                                "</div>");

                    }

                }


                //let allText = $(".TextVariable");

                //for (let i = 0; i < allText.length; i++) {

                //    let val = ($(allText[i]).attr('data-value') === undefined) ? "" : $(allText[i]).attr('data-value');

                //    console.log(val);

                //    $(allText[i]).kendoTextBox({
                //        value: val
                //    });
                //}

                $(".TextVariable").kendoTextBox({
                    value: $(this).attr('data-value')
                });


                $(".NumericalVariable").kendoNumericTextBox({
                    value: $(this).attr('data-value')
                });


            }
        });
    }

</script>